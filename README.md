**RU** | [EN](README_EN.md)

## Poppy

Свободная реализация OS X-подобного пользовательского опыта.

#### Концепт

![Концепт](Resources/Concept.png)

#### Скриншот

![Скриншот](Resources/Screenshot.png)

### Терминология

- **Poppy** &mdash; это свободный проект, развивающий сразу несколько направлений, в совокупности предоставляющих целостный пользовательский опыт, схожий с использованием Mac OS X (в частности, версии 10.9 Mavericks), но не включающий его самые худшие стороны, такие как привязка к конкретному оборудованию или плата за программное обеспечение. В отличие от проектов вроде pearOS и helloSystem - которые фокусируются преимущественно на поверхностной имитации интерфейса или заимствовании некоторых аспектов работы с macOS; GnuStep - предлагающего устаревшую реализацию Cocoa-подобных библиотек без непосредственно системной базы и пользовательского окружения; ravynOS - пытающегося добиться одновременно и визуальной и бинарной совместимости с Mac OS на голом энтузиазме; Poppy - строится как ультимативное решение, покрывающее и системный уровень, и пользовательскую среду, ценой осознанного отказа от совместимости с большей частью существующего ПО (не считая драйверов) на первых порах развития.
- Poppy Kernel (**Opium**) &mdash; ядро уровня 1, обеспечивающее _беспрекословную_ работоспособность PSC на UNIX-like ядрах уровня 0. Помимо абстракций над объектами нулевого ядра оно также обладает собственной логикой (например, Mach-like IPC, KEM и KSP). В обычной конфигурации выполняется как PID 1 поверх FreeBSD. Технически схоже с User-mode Linux, но первичная цель состоит не в изоляции, тестировании и удобстве отладки, а в независимости архитектуры при переиспользовании некоторого набора сторонних низкоуровневых решений.
	- Ядро уровня 0 &mdash; ядро ОС в привычном понимании. Загружается в память с помощью оборудования и загрузчика, общается с ресурсами системы напрямую, реализует объекты (такие как процессы, потоки, таймеры, файловые системы и т.д.) и интерфейс к ним, запускает PID 1.
	- Ядро уровня 1 &mdash; переносимое ядро. Как и нулевое, предоставляет системные вызовы, управляет процессами, связью между ними и прочими объектами. Первое ядро может во всём полагаться на нулевое или обладать дополнительными ограничениями и расширениями. В том или ином виде имеет Hardware Abstraction Layer (**HAL**), обеспечивающий работу как минимум на одной платформе. Если тот достаточно развит, то для запуска и выполнения нулевое ядро не требуется. В теории, любое нулевое ядро подходит в качестве "hardware", но на практике - лучше всего с этим справляются UNIX-like.
	- Kernel Execution Marshall (**KEM**) &mdash; в контексте Opium, расширяемая подсистема исполнения и координации различных программных сред и форматов (Root, WebAssembly, ELF...), выполняющая инициализацию процессов, динамическое связывание библиотек, а также маршаллинг данных и вызовов функций на уровне ядра. Маршалл стремиться обеспечить такой уровень бесшовной работы множества сред, при котором конечному пользователю не придётся думать о различиях между языками программирования или форматах распространения программ.
	- Kernel Security Policy (**KSP**) &mdash; в контексте Opium, декларативная подсистема безопасности, существующая как расширение POSIX-прав (UID, GID, PID), позволяющая тонко настраивать доступ к системным вызовам со стороны процессов, и явно обращающаяся к пользователю с помощью доверенных агентов (CLI и GUI) в спорных случаях. Политика позволяет настраивать доступ как на основе привычных POSIX, так и на основе новых логических ограничений. Обладает кешем решений и белым списком, может быть отключена по желанию администратора. Лучше всего работает, когда настроены пароли, но без них не становится бесполезной и все равно может ограничить даже UID 0. Ближайшие аналоги для сравнения - UAC и SELinux.
- [Poppy Programming Language (**Root**)](OS/System/Library/Kernels/Opium/Includes/ExecutionMarshall/Root) &mdash; системный интерпретируемый язык программирования общего назначения. Официально поставляется исключительно в рамках Opium KEM, однако потенциально поддерживает сборку переносимого интерпретатора. Значительная часть PSC (в частности, нетребовательного к производительности кода) пишется на Root.
- Poppy Software Collection (**PSC**) &mdash; набор библиотек, фреймворков, консольных программ и графических приложений, совместимых с UX и некоторой частью архитектуры Darwin и OS X. Большая часть ПО в коллекции является портом и обратным инжинирингом из GNU, GnuStep, Darwin и OS X. Базовая часть PSC в большей степени зависит от уровня POSIX-совместимости ядра, чем конкретно от Opium-специфичных системных вызовов, поэтому может быть использована на некоторых ядрах уровня 0 без изменений (при совместимости сред исполнения). Та же часть, которую видит пользователь в первую очередь, а именно: `launchd`, `WindowServer`, `LoginWindow`, `Enviro`, `Dock`, `System Preferences` и т.д., могут зависеть от особых механизмов ядра и файловой структуры Poppy OS, следовательно их работа вне Opium не гарантируется и не ожидается.
- Poppy Operating System (**Poppy OS**) &mdash; сборка FreeBSD + Root Server + Poppy Kernel + Poppy Software Collection. Всё то, к чему стремится проект Poppy, сходится в этой конечной точке. Операционную систему Poppy можно рассматривать как клон Mac OS X, если не вдаваться в подробности, и с пользовательской точки зрения это будет оправданно, однако система проходит совсем другой путь разработки: многие оригинальные решения пересматриваются, прежде чем в том или ином виде попасть в Poppy (например, система никого не ограничивает в возможностях разработки и установки тем).